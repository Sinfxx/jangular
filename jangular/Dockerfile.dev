####################################
# Development stage â€” Ubuntu + Maven + JDK 25
####################################
FROM ubuntu:24.04

ENV DEBIAN_FRONTEND=noninteractive
WORKDIR /opt

# Install tools
RUN apt-get update && \
    apt-get install -y wget tar unzip curl zip maven ca-certificates && \
    rm -rf /var/lib/apt/lists/*

# Install Amazon Corretto 25 based on architecture
ARG TARGETARCH
RUN if [ "$TARGETARCH" = "amd64" ]; then \
        wget -O corretto25.tar.gz https://corretto.aws/downloads/latest/amazon-corretto-25-x64-linux-jdk.tar.gz; \
    elif [ "$TARGETARCH" = "arm64" ]; then \
        wget -O corretto25.tar.gz https://corretto.aws/downloads/latest/amazon-corretto-25-aarch64-linux-jdk.tar.gz; \
    else \
        echo "Unsupported architecture: $TARGETARCH" && exit 1; \
    fi && \
    tar -xzf corretto25.tar.gz && \
    mv amazon-corretto-25* /opt/jdk25

ENV JAVA_HOME=/opt/jdk25
ENV PATH=$JAVA_HOME/bin:$PATH

# Verify Java
RUN java -version

WORKDIR /app

# Expose Spring Boot dev port
EXPOSE 8080

# Run with Spring Boot Maven plugin for hot reload
ENTRYPOINT ["./mvnw", "spring-boot:run"]
